###########
# License #
###########

Copyright (c) Quentin DASSIBAT <qdassibat@gmail.com>
-
Ecole des Mines de Saint-Etienne (EMSE)
Ecole Nationale des Travaux Publics de l'Etat (ENTPE)
Ecole Urbaine de Lyon (EUL)

# Source Code License (GPLv3)

This software and its source code are licensed under the GNU General Public License (GPL), version 3.0 or later. See the LICENSE file for details.

# Output License (CC BY 4.0)

Any outputs generated by this software, such as data files, images, or other results, are licensed under the Creative Commons Attribution 4.0 International License (CC BY 4.0).

You are free to share, adapt, and use these outputs, provided you give appropriate credit to the original author(s). See the LICENSE file for details.

# For details about each license, please refer to:
- GNU General Public License (GPL), version 3.0: https://www.gnu.org/licenses/gpl-3.0.html
- Creative Commons Attribution 4.0 International License (CC BY 4.0): http://creativecommons.org/licenses/by/4.0/

 

################
# Introduction #
################

This repository aims to ease the treatment of hydrographic data available on hubeau.fr API. The data consist of mean daily flows captured by a network of gauging stations operating throughout France, known as the Vigicrue network.

It is structured in several modules:

# MODULE 0
- for each station within the user-specified Area of Interest (AoI), it downloads the location, code, openning and closing date of each station
- for each station, it dowloads the mean daily flows over a user-specified Period of Interest
- it downloads the Digital Elevation Model (DEM) of the AoI
- it downmloads stream impoundment features from Open Street Map to further perform a hydrographic analysis
- it reprojects to the user-specified CRS the Corine Land Cover raster file attached to this repository

# MODULE 1
- it creates the topographic material that will be further used to export data as Polygon vector layers 
- it delineates the subcatchment of each station within the AoI, whether or not do they cover the time range

# MODULE 2
- it computes elaborated data (mean monthly flows and mean monthly flow deviations)
- exports them as 3 files : a point-geometry .gpkg vector file, a polygon-geometry .gpkg vector file (i.e. subcatchments), a .csv file
- optionally generates scatter plots of elaborated data for each station :
. "MMF" figures : hydrographs are plotted against their monthly coefficient of variations
. "MannKendall regression" figures : mean monthly flow over the whole time range are plotted against the linear trend 
- 2 products as outputs :
. "mmf_average": mean monthly flow averaged over the user-specified period for each station and gathered in a same file for all stations
. "mmf_all": mean monthly flow for each month separately in the user-specified period. Each station is saved as a separate file. 

# MODULE 3
- it delinates the subcatchments of those stations within the AoI that match the time range and have been analyzed in Module 2

# MODULE 4
- it generates renderings based on Modules 2 and 3 
- it joins the "MMF_average" product to the delineated catchments
- it joins the "MannKendall regression" product to the delineated catchments
- it generates maps :
. one mapping the long-term trend of mean monthly flows for each subcatchment
. one mapping the long-term trend of mean monthly deviations for each subcatchment
. one mapping the mean annual coefficient of variation for each subcatchment

# MODULE 5
- it requires these 2 additionnal files to be downloaded at https://seafile.emse.fr/d/d21e4a3c2bf74432adfc/ and placed in the same directory as main.py and hydrofunc.py
- it performs a spatial analysis of flow deviation
- it computes the correlation matrix betwwen land occupation, strem impoundments and flow variability (or deviation, captured through the annual coefficients of variation)
- it outputs two figures:
. "Pearson correlation matrix" figure: the core product of spatial analysis
. "p-values matrix" figure: the corresponding significance of the Pearson correlation matrix

  

###########
# Content #
###########

# main.py
- Python3 file containing the main script
- user is required to set the parameters contained in the "set parameters" section (WARNING: user is not advised to work with another CRS that EPSG:4326 at this stage)
- user is not advised to customize the "set directories" section, which set directories paths that will be created as the code runs

# hydrofunc.py
- Python3 file containing the core functions that main.py runs  

# HydroTrendsFrance_documentation.pdf (in progress)
- documentation explaining each executable MODULE in main.py 

############################
# Environment requirements #
############################

The scripts have be developped for Python3 (with Python 3.10.12)

The scripts need the following additional libraries (with their version used for development): 
- geopandas (0.3.12)
- pandas (2.1.1)
- json (0.17.0)
- shapely (2.0.1)
- requests (2.31.0)
- numpy (1.26.0)
- pcraster (4.4.1)
- scipy (1.13.1)
- seaborn (0.13.2)
- contextily (1.6.0)
- gdal (3.8.4)
- matplotlib (3.8.3)
- osmnx (1.9.3)
- pyproj (3.6.1)

These libraries can be easilly installed using "pip install lib_name" or "conda install lib_name".
Except PCRaster, which needs to be installed following the doc: https://pcraster.geo.uu.nl/pcraster/4.4.0/documentation/pcraster_project/install.html 
